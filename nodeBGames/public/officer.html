<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Rose-Hulman Board Games Club Rental Service</title>
        <link rel="stylesheet" type="text/css" href="stylesheet.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="menu.js"></script>
    </head>

    <body>
        <div id="site_background">
            <div id="site_panel">
                <span id="title_section">
                    <img src="rose.png" alt="RHIT Logo" width="128" height="128" id="img_logo"/>
                    Rose-Hulman Board Game Rental Service
                </span>
                <ul id="top_menu" class="full_width">
                    <li><a type="button" class="menu_item" href="javascript:goToHomepage()">
                            Home
                    </a></li>
                    <li><a type="button" class="menu_item" href="javascript:goToClubpage()">
                            Club
                    </a></li>
                    <li><a type="button" class="menu_item" href="javascript:goToHelp()">
                            Help
                    </a></li>
                    <li><a type="button" class="menu_item" href="javascript:goToProfile()">
                            Profile
                    </a></li>
                    <li><a type="button" class="menu_item" href="javascript:goToSuggestion()">
                            Suggestions
                    </a></li>
                    <li><a type="button" class="menu_item" href="javascript:goToOfficer()">
                            Officer Page
                    </a></li>
                </ul>
                <div id="control_button_panel" class="content_panel full_width">
                    <div class="content full_width">
                        <ul id="officer_menu" class="full_width">
                            <li><a id="add_game_toggle" type="button" class="officer_menu_item" href="javascript:toggleView(0)">
                                    Add New Game
                            </a></li>
                            <li><a id="add_copy_toggle" type="button" class="officer_menu_item" href="javascript:toggleView(1)">
                                    Add Copy of Game
                            </a></li>
                            <li><a id="check_in_toggle" type="button" class="officer_menu_item" href="javascript:toggleView(2)">
                                    Check In Game
                            </a></li>
                            <li><a id="suggestions_toggle" type="button" class="officer_menu_item" href="javascript:toggleView(3)">
                                    View Suggestions
                            </a></li>
                            <li><a id="fees_toggle" type="button" class="officer_menu_item" href="javascript:toggleView(4)">
                                    View Fees
                            </a></li>
                            <li><a id="create_fees_toggle" type="button" class="officer_menu_item" href="javascript:toggleView(5)">
                                    Assess Fees
                            </a></li>
                        </ul>
                    </div>
                </div>
                <div id="add_game_panel" style="display: none;" class="content_panel full_width">
                    <div class="content full_width">
                        <p class="large_text">Add Game</p>
                        <hr>
                        <div class="full_width padded">
                            <p class="medium_text">Name:</p>
                            <input id="add_game_name" type="text">
                        </div>
                        <div class="full_width padded">
                            <p class="medium_text">Description:</p>
                            <input id="add_game_desc" type="text">
                        </div>
                        <div class="full_width padded">
                            <p class="medium_text">Complexity:</p>
                            <input id="add_game_complexity" type="number">
                        </div>
                        <div class="full_width padded">
                            <p class="medium_text">Playtime:</p>
                            <input id="add_game_playtime" type="text">
                        </div>
                        <div class="full_width padded">
                            <p class="medium_text">Maximum Number of Players:</p>
                            <input id="add_game_players" type="number">
                        </div>
                        <div class="full_width padded">
                            <p class="medium_text">Number of Copies to Add:</p>
                            <input id="add_game_copies" type="number">
                        </div>
                        <div class="padded">
                            <a class="menu_item table_element_medium" href="javascript:addGame()">Add Game</a>
                        </div>
                    </div>
                </div>
                <div id="add_copy_panel" style="display: none;" class="content_panel full_width">
                    <div class="content full_width">
                        <p class="large_text">Add Copy</p>
                        <hr>
                        <div class="full_width padded">
                            <p class="medium_text">Game Name:</p>
                            <select id="game_dropdown"></select>
                        </div>
                        <div class="full_width padded">
                            <p class="medium_text">Copies to Add:</p>
                            <input id="add_copy_number" type="number">
                        </div>
                        <div class="padded">
                            <a class="menu_item table_element_medium" href="javascript:addCopies()">Add Copy</a>
                        </div>
                    </div>
                </div>
                <div id="check_in_panel" style="display: none;" class="content_panel full_width">
                    <div class="content full_width">
                        <p class="large_text">Check In Games</p>
                        <hr>
                    </div>
                    <div class="table_header full_width content">
                        <table class="full_width">
                            <tr class="full_width">
                                <td class="table_element_short">Username</td>
                                <td class="table_element_short">Copy ID</td>
                                <td class="table_element_long">Game</td>
                                <td class="table_element_long">Due Date</td>
                                <td class="table_element_medium"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="content full_width">
                        <table id="check_in_table" class="full_width"></table>
                    </div>
                </div>
                <div id="suggestions_panel" style="display: none;" class="content_panel full_width">
                    <div class="content full_width">
                        <p class="large_text">Suggestions</p>
                        <hr>
                        <table id="suggestions_table" class="full_width"></table>
                    </div>
                </div>
                <div id="fees_panel" style="display: none;" class="content_panel full_width">
                    <div class="content full_width">
                        <p class="large_text">Fees</p>
                        <hr>
                    </div>
                    <div class="table_header full_width content">
                        <table class="full_width">
                            <tr class="full_width">
                                <td class="table_element_short">Fee ID</td>
                                <td class="table_element_medium">Username</td>
                                <td class="table_element_short">Amount</td>
                                <td class="table_element_long">Reason</td>
                                <td class="table_element_short">Paid</td>
                                <td class="table_element_medium"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="content full_width">
                        <table id="fees_table" class="full_width"></table>
                    </div>
                </div>
                <div id="create_fees_panel" style="display: none;" class="content_panel full_width">
                    <div class="content full_width">
                        <p class="large_text">Assess Fee</p>
                        <hr>
                        <div class="full_width padded">
                            <p class="medium_text">Username:</p>
                            <input id="add_fee_username" type="text">
                        </div>
                        <div class="full_width padded">
                            <p class="medium_text">Amount:</p>
                            <input id="add_fee_amount" type="number">
                        </div>
                        <div class="full_width padded">
                            <p class="medium_text">Reason:</p>
                            <input id="add_fee_reason" type="text">
                        </div>
                        <div class="padded">
                            <a class="menu_item table_element_medium" href="javascript:addFee()">Create Fee</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>

    <script>
        window.onload = officerLogin();

		var game_name = document.getElementById("add_game_name");
		var game_desc = document.getElementById("add_game_desc");
		var game_complexity = document.getElementById("add_game_complexity");
		var game_playtime = document.getElementById("add_game_playtime");
		var game_numPlayers = document.getElementById("add_game_players");
        var game_numCopies = document.getElementById("add_game_copies");

        var copy_name = document.getElementById("game_dropdown");
        var copy_number = document.getElementById("add_copy_number");
        
        var fee_username = document.getElementById("add_fee_username");
        var fee_amount = document.getElementById("add_fee_amount");
        var fee_reason = document.getElementById("add_fee_reason");
        
        var add_game_toggle = document.getElementById("add_game_toggle");
        var add_game_panel = document.getElementById("add_game_panel");
        var add_game_panel_visible = false;

        var add_copy_toggle = document.getElementById("add_copy_toggle");
        var add_copy_panel = document.getElementById("add_copy_panel");
        var add_copy_panel_visible = false;

        var check_in_toggle = document.getElementById("check_in_toggle");
        var check_in_panel = document.getElementById("check_in_panel");
        var check_in_panel_visible = false;

        var suggestions_toggle = document.getElementById("suggestions_toggle");
        var suggestions_panel = document.getElementById("suggestions_panel");
        var suggestions_panel_visible = false;

        var fees_toggle = document.getElementById("fees_toggle");
        var fees_panel = document.getElementById("fees_panel");
        var fees_panel_visible = false;

        var create_fees_toggle = document.getElementById("create_fees_toggle");
        var create_fees_panel = document.getElementById("create_fees_panel");
        var create_fees_panel_visible = false;

        function toggleView(index) {
            if(index == 0) {
                if(add_game_panel_visible) {
                    add_game_panel_visible = false;
                    add_game_panel.setAttribute("style", "display: none;");
                    add_game_toggle.setAttribute("style", "background-color: none;");
                } else {
                    add_game_panel_visible = true;
                    add_game_panel.setAttribute("style", "visibility: visible;");
                    add_copy_panel.setAttribute("style", "display: none;");
                    check_in_panel.setAttribute("style", "display: none;");
                    suggestions_panel.setAttribute("style", "display: none;");
                    fees_panel.setAttribute("style", "display: none;");
                    create_fees_panel.setAttribute("style", "display: none");
                    add_game_toggle.setAttribute("style", "background-color: lightgray;");
                    add_copy_toggle.setAttribute("style", "background-color: none;");
                    check_in_toggle.setAttribute("style", "background-color: none;");
                    suggestions_toggle.setAttribute("style", "background-color: none;");
                    fees_toggle.setAttribute("style", "background-color: none;");
                    create_fees_toggle.setAttribute("style", "background-color: none;");
                }
            } else if(index == 1) {
                if(add_copy_panel_visible) {
                    add_copy_panel_visible = false;
                    add_copy_panel.setAttribute("style", "display: none;");
                    add_copy_toggle.setAttribute("style", "background-color: none;");
                } else {
                    add_copy_panel_visible = true;
                    add_game_panel.setAttribute("style", "display: none;");
                    add_copy_panel.setAttribute("style", "visibility: visible;");
                    check_in_panel.setAttribute("style", "display: none;");
                    suggestions_panel.setAttribute("style", "display: none;");
                    fees_panel.setAttribute("style", "display: none;");
                    create_fees_panel.setAttribute("style", "display: none");
                    add_game_toggle.setAttribute("style", "background-color: none;");
                    add_copy_toggle.setAttribute("style", "background-color: lightgray;");
                    check_in_toggle.setAttribute("style", "background-color: none;");
                    suggestions_toggle.setAttribute("style", "background-color: none;");
                    fees_toggle.setAttribute("style", "background-color: none;");
                    create_fees_toggle.setAttribute("style", "background-color: none;");
                    getGames();
                }
            } else if(index == 2) {
                if(check_in_panel_visible) {
                    check_in_panel_visible = false;
                    check_in_panel.setAttribute("style", "display: none;");
                    check_in_toggle.setAttribute("style", "background-color: none;");
                } else {
                    check_in_panel_visible = true;
                    add_game_panel.setAttribute("style", "display: none;");
                    add_copy_panel.setAttribute("style", "display: none;");
                    check_in_panel.setAttribute("style", "visibility: visible;");
                    suggestions_panel.setAttribute("style", "display: none;");
                    fees_panel.setAttribute("style", "display: none;");
                    create_fees_panel.setAttribute("style", "display: none");
                    add_game_toggle.setAttribute("style", "background-color: none;");
                    add_copy_toggle.setAttribute("style", "background-color: none;");
                    check_in_toggle.setAttribute("style", "background-color: lightgray;");
                    suggestions_toggle.setAttribute("style", "background-color: none;");
                    fees_toggle.setAttribute("style", "background-color: none;");
                    create_fees_toggle.setAttribute("style", "background-color: none;");
                    getAllCheckedOut();
                }
            } else if(index == 3) {
                if(suggestions_panel_visible) {
                    suggestions_panel_visible = false;
                    suggestions_panel.setAttribute("style", "display: none;");
                    suggestions_toggle.setAttribute("style", "background-color: none;");
                } else {
                    suggestions_panel_visible = true;
                    add_game_panel.setAttribute("style", "display: none;");
                    add_copy_panel.setAttribute("style", "display: none;");
                    check_in_panel.setAttribute("style", "display: none;");
                    suggestions_panel.setAttribute("style", "visibility: visible;");
                    fees_panel.setAttribute("style", "display: none;");
                    create_fees_panel.setAttribute("style", "display: none");
                    add_game_toggle.setAttribute("style", "background-color: none;");
                    add_copy_toggle.setAttribute("style", "background-color: none;");
                    check_in_toggle.setAttribute("style", "background-color: none;");
                    suggestions_toggle.setAttribute("style", "background-color: lightgray;");
                    fees_toggle.setAttribute("style", "background-color: none;");
                    create_fees_toggle.setAttribute("style", "background-color: none;");
                    getSuggestions();
                }
            } else if(index == 4) {
                if(fees_panel_visible) {
                    fees_panel_visible = false;
                    fees_panel.setAttribute("style", "display: none;");
                    fees_toggle.setAttribute("style", "background-color: none;");
                } else {
                    fees_panel_visible = true;
                    add_game_panel.setAttribute("style", "display: none;");
                    add_copy_panel.setAttribute("style", "display: none;");
                    check_in_panel.setAttribute("style", "display: none;");
                    suggestions_panel.setAttribute("style", "display: none;");
                    fees_panel.setAttribute("style", "visibility: visible;");
                    create_fees_panel.setAttribute("style", "display: none");
                    add_game_toggle.setAttribute("style", "background-color: none;");
                    add_copy_toggle.setAttribute("style", "background-color: none;");
                    check_in_toggle.setAttribute("style", "background-color: none;");
                    suggestions_toggle.setAttribute("style", "background-color: none;");
                    fees_toggle.setAttribute("style", "background-color: lightgray;");
                    create_fees_toggle.setAttribute("style", "background-color: none;");
                    getFees();
                }
            } else if(index == 5) {
                if(create_fees_panel_visible) {
                    create_fees_panel_visible = false;
                    create_fees_panel.setAttribute("style", "display: none;");
                    create_fees_toggle.setAttribute("style", "background-color: none;");
                } else {
                    create_fees_panel_visible = true;
                    add_game_panel.setAttribute("style", "display: none;");
                    add_copy_panel.setAttribute("style", "display: none;");
                    check_in_panel.setAttribute("style", "display: none;");
                    suggestions_panel.setAttribute("style", "display: none;");
                    fees_panel.setAttribute("style", "display: none;");
                    create_fees_panel.setAttribute("style", "visibility: visible;");
                    add_game_toggle.setAttribute("style", "background-color: none;");
                    add_copy_toggle.setAttribute("style", "background-color: none;");
                    check_in_toggle.setAttribute("style", "background-color: none;");
                    suggestions_toggle.setAttribute("style", "background-color: none;");
                    fees_toggle.setAttribute("style", "background-color: none;");
                    create_fees_toggle.setAttribute("style", "background-color: lightgray;");
                }
            }
        }

        function getGames() {
			$.get('/search',{searchTerm: ""},function(recordset){
                var dropdown = document.getElementById("game_dropdown");
                while (dropdown.firstChild) {
                    dropdown.removeChild(dropdown.firstChild);
                }
                var result, option, text;
                for(var index in recordset) {
                    result = recordset[index];

                    option = document.createElement("option");
                    option.setAttribute("value", result.name);
                    text = document.createTextNode(result.name);
                    option.appendChild(text);
                    dropdown.appendChild(option);
                }
			});
        }

		function addGame() {
			console.log("adding Game");
            var input1 = game_name.value;
            game_name.value = "";
            var input2 = game_desc.value;
            game_desc.value = "";
            var input3 = game_complexity.value;
            game_complexity.value = "";
            var input4 = game_playtime.value;
            game_playtime.value = "";
            var input5 = game_numPlayers.value;
            game_numPlayers.value = "";
            var input6 = game_numCopies.value;
            game_numCopies.value = "";
			console.log(input1);
			$.get('/addGame',{name: input1,description: input2,complexity: input3,playTime: input4,numPlayers: input5,numOfCopies: input6}, function(result){
                console.log(result);
            });
        }

        function addFee() {
			console.log("adding Fee");
            var input1 = fee_username.value;
            fee_username.value = "";
            var input2 = fee_amount.value;
            fee_amount.value = "";
            var input3 = fee_reason.value;
            fee_reason.value = "";
			console.log(input1);
			$.get('/addFee',{username: input1,amount: input2,reason: input3,}, function(result){
                console.log(result);
            });
        }

        function payFee(fid) {
			console.log("paying Fee");
            var input1 = fid;
			console.log(input1);
			$.get('/payFee',{fid: input1,}, function(result){
                console.log(result);
                getFees();
            });
        }
        
        function officerLogin() {
            $.get('/officerCheck',function(result){
                console.log(result);
				/*
                if(result[0].Officer < 1) {
                    alert("You are not an officer!");
                    goToHomepage();
                }*/
            }); 
        }
		
		function addCopies() {
			console.log("adding Copies");
            var input1 = copy_name.value;
            copy_name.value = "";
            var input2 = copy_number.value;
            copy_number.value = "";
			$.get('/addCopy',{name: input1, quantity: input2}, function(result){
                console.log(result);
            }); 
		}
		
		function getSuggestions() {
		     $.get('/getSuggestions',function(recordset){
                console.log(recordset);
			    var table = document.getElementById("suggestions_table");
                while (table.firstChild) {
                    table.removeChild(table.firstChild);
                }
                var result, row, cell, text;
                for(var index in recordset) {
                    result = recordset[index];

                    row = document.createElement("tr");
                    row.setAttribute("class", "full_width");

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_short");
                    text = document.createTextNode(result.username);
                    cell.appendChild(text);
                    row.appendChild(cell);

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_long");
                    text = document.createTextNode(result.suggestion);
                    cell.appendChild(text);
                    row.appendChild(cell);

                    table.appendChild(row);
                }
            }); 
        }

        function getFees() {
		     $.get('/getAllFees',function(recordset){
                console.log(recordset);
			    var table = document.getElementById("fees_table");
                while (table.firstChild) {
                    table.removeChild(table.firstChild);
                }
                var result, row, cell, text;
                for(var index in recordset) {
                    result = recordset[index];

                    row = document.createElement("tr");
                    row.setAttribute("class", "full_width");

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_short");
                    text = document.createTextNode(result.fid);
                    cell.appendChild(text);
                    row.appendChild(cell);

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_medium");
                    text = document.createTextNode(result.username);
                    cell.appendChild(text);
                    row.appendChild(cell);

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_short");
                    text = document.createTextNode(result.amount);
                    cell.appendChild(text);
                    row.appendChild(cell);

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_long");
                    text = document.createTextNode(result.reason);
                    cell.appendChild(text);
                    row.appendChild(cell);

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_short");
                    text = document.createTextNode(result.paid);
                    cell.appendChild(text);
                    row.appendChild(cell);

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_medium");
                    if(!result.paid) {
                        button = document.createElement("button");
                        button.setAttribute("class", "menu_item");
                        text = document.createTextNode("Mark as Paid");
                        button.setAttribute("onclick", "payFee(" + result.fid + ");");
                        button.appendChild(text);
                        cell.appendChild(button);
                    }
                    row.appendChild(cell);

                    table.appendChild(row);
                }
            }); 
        }
        
        function checkIn(game) {
			console.log(game);
            $.get('/checkIn', {gid: game});
            alert("Checked in " + game);
            getAllCheckedOut();
		}
		
		function getAllCheckedOut() {
		   $.get('/getAllCheckedOut',function(recordset){
                console.log(recordset);
			    var table = document.getElementById("check_in_table");
                while (table.firstChild) {
                    table.removeChild(table.firstChild);
                }
                var result, row, cell, text;
                for(var index in recordset) {
                    result = recordset[index];

                    row = document.createElement("tr");
                    row.setAttribute("class", "full_width");

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_short");
                    text = document.createTextNode(result.borrower);
                    cell.appendChild(text);
                    row.appendChild(cell);

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_short");
                    text = document.createTextNode(result.gid);
                    cell.appendChild(text);
                    row.appendChild(cell);

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_long");
                    text = document.createTextNode(result.copyOf);
                    cell.appendChild(text);
                    row.appendChild(cell);

                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_long");
                    text = document.createTextNode((result.dueDate).substring(0,10));
                    cell.appendChild(text);
                    row.appendChild(cell);
                    
                    cell = document.createElement("td");
                    cell.setAttribute("class", "table_element_medium");
                    button = document.createElement("button");
                    button.setAttribute("class", "menu_item");
                    text = document.createTextNode("Check In");
                    button.setAttribute("onclick", "checkIn(" + result.gid + ");");
                    button.appendChild(text);
                    cell.appendChild(button);
                    row.appendChild(cell);

                    table.appendChild(row);
                }
            }); 
		}

    </script>
</html>